import{e as W,B as K,r as J,g as O,f as Y,b as a,k as re,z as Pe,m as Q,n as _e,q as Se,y as xe,ab as te,o as Ce,c as Ie,w as L,u as ae,d as ke}from"./index-4aaa8925.js";import{C as ze,u as Te}from"./user-f59733cb.js";import{I as ee}from"./index-371a1e32.js";import{S as Re,a as De}from"./index-03002181.js";import{u as Ae}from"./user-3e3db9dc.js";import{u as Fe,P as Le,m as Ze,b as Be,c as ne,s as Ne,a as Oe}from"./function-call-c8e6cc7f.js";import"./index-0510137f.js";import{c as oe,b as X,n as G,u as Ue,a as j,d as U,L as Xe,t as A,f as ce,g as B,h as se,m as N,i as Ee,j as Ye,p as E,k as Me,H as He,I as M,l as Ve,e as $,w as ue,o as de,q as $e,r as me,s as We,v as je,x as qe}from"./index-1d524986.js";import{u as ve}from"./use-expose-4d3535a4.js";import{L as fe}from"./index-0401c95d.js";import{c as ge}from"./interceptor-e50a7bfa.js";import{B as Ge}from"./index-81d9fd27.js";import{C as Ke}from"./index-9335d5c9.js";import"./serviceAxios-fb88dc5b.js";import"./on-popup-reopen-bc1917c0.js";import"./index-098f33cf.js";import"./use-route-650222ba.js";const ie=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),q=oe("image-preview")[1];var Je=W({props:{src:String,show:Boolean,active:Number,minZoom:X(G),maxZoom:X(G),rootWidth:X(Number),rootHeight:X(Number),disableZoom:Boolean},emits:["scale","close","longPress"],setup(e,{emit:s,slots:i}){const o=K({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),l=Fe(),b=J(),d=O(()=>{const{rootWidth:n,rootHeight:v}=e,m=v/n;return o.imageRatio>m}),h=O(()=>{const{scale:n,moveX:v,moveY:m,moving:C,zooming:D}=o,H={transitionDuration:D||C?"0s":".3s"};if(n!==1){const be=v/n,ye=m/n;H.transform=`scale(${n}, ${n}) translate(${be}px, ${ye}px)`}return H}),y=O(()=>{if(o.imageRatio){const{rootWidth:n,rootHeight:v}=e,m=d.value?v/o.imageRatio:n;return Math.max(0,(o.scale*m-n)/2)}return 0}),r=O(()=>{if(o.imageRatio){const{rootWidth:n,rootHeight:v}=e,m=d.value?v:n*o.imageRatio;return Math.max(0,(o.scale*m-v)/2)}return 0}),c=n=>{n=U(n,+e.minZoom,+e.maxZoom+1),n!==o.scale&&(o.scale=n,s("scale",{scale:n,index:e.active}))},P=()=>{c(1),o.moveX=0,o.moveY=0},w=()=>{const n=o.scale>1?1:2;c(n),o.moveX=0,o.moveY=0};let S,z,T,F,R,u,I,t=!1;const f=n=>{const{touches:v}=n;if(S=v.length,S===2&&e.disableZoom)return;const{offsetX:m}=l;l.start(n),z=o.moveX,T=o.moveY,I=Date.now(),t=!1,o.moving=S===1&&o.scale!==1,o.zooming=S===2&&!m.value,o.zooming&&(F=o.scale,R=ie(n.touches))},_=n=>{const{touches:v}=n;if(l.move(n),o.moving){const{deltaX:m,deltaY:C}=l,D=m.value+z,H=C.value+T;if((D>y.value||D<-y.value)&&!t&&l.isHorizontal()){o.moving=!1;return}t=!0,j(n,!0),o.moveX=U(D,-y.value,y.value),o.moveY=U(H,-r.value,r.value)}if(o.zooming&&(j(n,!0),v.length===2)){const m=ie(v),C=F*m/R;c(C)}},p=()=>{if(S>1)return;const{offsetX:n,offsetY:v}=l,m=Date.now()-I,C=250,D=5;n.value<D&&v.value<D&&(m<C?u?(clearTimeout(u),u=null,w()):u=setTimeout(()=>{s("close"),u=null},C):m>Xe&&s("longPress"))},x=n=>{let v=!1;if((o.moving||o.zooming)&&(v=!0,o.moving&&z===o.moveX&&T===o.moveY&&(v=!1),!n.touches.length)){o.zooming&&(o.moveX=U(o.moveX,-y.value,y.value),o.moveY=U(o.moveY,-r.value,r.value),o.zooming=!1),o.moving=!1,z=0,T=0,F=1,o.scale<1&&P();const m=+e.maxZoom;o.scale>m&&(o.scale=m)}j(n,v),p(),l.reset()},k=n=>{const{naturalWidth:v,naturalHeight:m}=n.target;o.imageRatio=m/v};return Y(()=>e.active,P),Y(()=>e.show,n=>{n||P()}),Ue("touchmove",_,{target:O(()=>{var n;return(n=b.value)==null?void 0:n.$el})}),()=>{const n={loading:()=>a(fe,{type:"spinner"},null)};return a(Re,{ref:b,class:q("swipe-item"),onTouchstartPassive:f,onTouchend:x,onTouchcancel:x},{default:()=>[i.image?a("div",{class:q("image-wrap")},[i.image({src:e.src})]):a(ee,{src:e.src,fit:"contain",class:q("image",{vertical:d.value}),style:h.value,onLoad:k},n)]})}}});const[Qe,Z]=oe("image-preview"),eo=["show","teleport","transition","overlayStyle","closeOnPopstate"],oo={show:Boolean,loop:A,images:ce(),minZoom:B(1/3),maxZoom:B(3),overlay:A,closeable:Boolean,showIndex:A,className:se,closeIcon:N("clear"),transition:String,beforeClose:Function,overlayClass:se,overlayStyle:Object,swipeDuration:B(300),startPosition:B(0),showIndicators:Boolean,closeOnPopstate:A,closeIconPosition:N("top-right"),teleport:[String,Object]};var he=W({name:Qe,props:oo,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:s,slots:i}){const o=J(),l=K({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),b=()=>{if(o.value){const u=Me(o.value.$el);l.rootWidth=u.width,l.rootHeight=u.height,o.value.resize()}},d=u=>s("scale",u),h=u=>s("update:show",u),y=()=>{ge(e.beforeClose,{args:[l.active],done:()=>h(!1)})},r=u=>{u!==l.active&&(l.active=u,s("change",u))},c=()=>{if(e.showIndex)return a("div",{class:Z("index")},[i.index?i.index({index:l.active}):`${l.active+1} / ${e.images.length}`])},P=()=>{if(i.cover)return a("div",{class:Z("cover")},[i.cover()])},w=()=>{l.disableZoom=!0},S=()=>{l.disableZoom=!1},z=()=>a(De,{ref:o,lazyRender:!0,loop:e.loop,class:Z("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:r,onDragEnd:S,onDragStart:w},{default:()=>[e.images.map((u,I)=>a(Je,{src:u,show:e.show,active:l.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:l.rootWidth,rootHeight:l.rootHeight,disableZoom:l.disableZoom,onScale:d,onClose:y,onLongPress:()=>s("longPress",{index:I})},{image:i.image}))]}),T=()=>{if(e.closeable)return a(M,{role:"button",name:e.closeIcon,class:[Z("close-icon",e.closeIconPosition),He],onClick:y},null)},F=()=>s("closed"),R=(u,I)=>{var t;return(t=o.value)==null?void 0:t.swipeTo(u,I)};return ve({swipeTo:R}),re(b),Y([Ee,Ye],b),Y(()=>e.startPosition,u=>r(+u)),Y(()=>e.show,u=>{const{images:I,startPosition:t}=e;u?(r(+t),Pe(()=>{b(),R(+t,{immediate:!0})})):s("close",{index:l.active,url:I[l.active]})}),()=>a(Le,Q({class:[Z(),e.className],overlayClass:[Z("overlay"),e.overlayClass],onClosed:F,"onUpdate:show":h},E(e,eo)),{default:()=>[T(),z(),c(),P()]})}});let V;const to={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function ao(){({instance:V}=Ze({setup(){const{state:e,toggle:s}=Be(),i=()=>{e.images=[]};return()=>a(he,Q(e,{onClosed:i,"onUpdate:show":s}),null)}}))}const no=(e,s=0)=>{if(Ve)return V||ao(),e=Array.isArray(e)?{images:e,startPosition:s}:e,V.open($({},to,e)),V};ue(he);const[so,g,io]=oe("uploader");function le(e,s){return new Promise(i=>{if(s==="file"){i();return}const o=new FileReader;o.onload=l=>{i(l.target.result)},s==="dataUrl"?o.readAsDataURL(e):s==="text"&&o.readAsText(e)})}function we(e,s){return de(e).some(i=>i.file?$e(s)?s(i.file):i.file.size>+s:!1)}function lo(e,s){const i=[],o=[];return e.forEach(l=>{we(l,s)?o.push(l):i.push(l)}),{valid:i,invalid:o}}const ro=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg|avif)/i,co=e=>ro.test(e);function pe(e){return e.isImage?!0:e.file&&e.file.type?e.file.type.indexOf("image")===0:e.url?co(e.url):typeof e.content=="string"?e.content.indexOf("data:image")===0:!1}var uo=W({props:{name:G,item:X(Object),index:Number,imageFit:String,lazyLoad:Boolean,deletable:Boolean,previewSize:[Number,String,Array],beforeDelete:Function},emits:["delete","preview"],setup(e,{emit:s,slots:i}){const o=()=>{const{status:r,message:c}=e.item;if(r==="uploading"||r==="failed"){const P=r==="failed"?a(M,{name:"close",class:g("mask-icon")},null):a(fe,{class:g("loading")},null),w=We(c)&&c!=="";return a("div",{class:g("mask")},[P,w&&a("div",{class:g("mask-message")},[c])])}},l=r=>{const{name:c,item:P,index:w,beforeDelete:S}=e;r.stopPropagation(),ge(S,{args:[P,{name:c,index:w}],done:()=>s("delete")})},b=()=>s("preview"),d=()=>{if(e.deletable&&e.item.status!=="uploading"){const r=i["preview-delete"];return a("div",{role:"button",class:g("preview-delete",{shadow:!r}),tabindex:0,"aria-label":io("delete"),onClick:l},[r?r():a(M,{name:"cross",class:g("preview-delete-icon")},null)])}},h=()=>{if(i["preview-cover"]){const{index:r,item:c}=e;return a("div",{class:g("preview-cover")},[i["preview-cover"]($({index:r},c))])}},y=()=>{const{item:r,lazyLoad:c,imageFit:P,previewSize:w}=e;return pe(r)?a(ee,{fit:P,src:r.content||r.url,class:g("preview-image"),width:Array.isArray(w)?w[0]:w,height:Array.isArray(w)?w[1]:w,lazyLoad:c,onClick:b},{default:h}):a("div",{class:g("file"),style:me(e.previewSize)},[a(M,{class:g("file-icon"),name:"description"},null),a("div",{class:[g("file-name"),"van-ellipsis"]},[r.file?r.file.name:r.url]),h()])};return()=>a("div",{class:g("preview")},[y(),o(),d()])}});const mo={name:B(""),accept:N("image/*"),capture:String,multiple:Boolean,disabled:Boolean,readonly:Boolean,lazyLoad:Boolean,maxCount:B(1/0),imageFit:N("cover"),resultType:N("dataUrl"),uploadIcon:N("photograph"),uploadText:String,deletable:A,afterRead:Function,showUpload:A,modelValue:ce(),beforeRead:Function,beforeDelete:Function,previewSize:[Number,String,Array],previewImage:A,previewOptions:Object,previewFullImage:A,maxSize:{type:[Number,String,Function],default:1/0}};var vo=W({name:so,props:mo,emits:["delete","oversize","clickUpload","closePreview","clickPreview","update:modelValue"],setup(e,{emit:s,slots:i}){const o=J(),l=[],b=(t=e.modelValue.length)=>({name:e.name,index:t}),d=()=>{o.value&&(o.value.value="")},h=t=>{if(d(),we(t,e.maxSize))if(Array.isArray(t)){const f=lo(t,e.maxSize);if(t=f.valid,s("oversize",f.invalid,b()),!t.length)return}else{s("oversize",t,b());return}t=K(t),s("update:modelValue",[...e.modelValue,...de(t)]),e.afterRead&&e.afterRead(t,b())},y=t=>{const{maxCount:f,modelValue:_,resultType:p}=e;if(Array.isArray(t)){const x=+f-_.length;t.length>x&&(t=t.slice(0,x)),Promise.all(t.map(k=>le(k,p))).then(k=>{const n=t.map((v,m)=>{const C={file:v,status:"",message:""};return k[m]&&(C.content=k[m]),C});h(n)})}else le(t,p).then(x=>{const k={file:t,status:"",message:""};x&&(k.content=x),h(k)})},r=t=>{const{files:f}=t.target;if(e.disabled||!f||!f.length)return;const _=f.length===1?f[0]:[].slice.call(f);if(e.beforeRead){const p=e.beforeRead(_,b());if(!p){d();return}if(qe(p)){p.then(x=>{y(x||_)}).catch(d);return}}y(_)};let c;const P=()=>s("closePreview"),w=t=>{if(e.previewFullImage){const f=e.modelValue.filter(pe),_=f.map(p=>(p.file&&!p.url&&p.status!=="failed"&&(p.url=URL.createObjectURL(p.file),l.push(p.url)),p.url)).filter(Boolean);c=no($({images:_,startPosition:f.indexOf(t),onClose:P},e.previewOptions))}},S=()=>{c&&c.close()},z=(t,f)=>{const _=e.modelValue.slice(0);_.splice(f,1),s("update:modelValue",_),s("delete",t,b(f))},T=(t,f)=>{const _=["imageFit","deletable","previewSize","beforeDelete"],p=$(E(e,_),E(t,_,!0));return a(uo,Q({item:t,index:f,onClick:()=>s("clickPreview",t,b(f)),onDelete:()=>z(t,f),onPreview:()=>w(t)},E(e,["name","lazyLoad"]),p),E(i,["preview-cover","preview-delete"]))},F=()=>{if(e.previewImage)return e.modelValue.map(T)},R=t=>s("clickUpload",t),u=()=>{if(e.modelValue.length>=+e.maxCount)return;const t=e.readonly?null:a("input",{ref:o,type:"file",class:g("input"),accept:e.accept,capture:e.capture,multiple:e.multiple,disabled:e.disabled,onChange:r},null);return i.default?a("div",{class:g("input-wrapper"),onClick:R},[i.default(),t]):Se(a("div",{class:g("upload",{readonly:e.readonly}),style:me(e.previewSize),onClick:R},[a(M,{name:e.uploadIcon,class:g("upload-icon")},null),e.uploadText&&a("span",{class:g("upload-text")},[e.uploadText]),t]),[[xe,e.showUpload]])},I=()=>{o.value&&!e.disabled&&o.value.click()};return _e(()=>{l.forEach(t=>URL.revokeObjectURL(t))}),ve({chooseFile:I,closeImagePreview:S}),je(()=>e.modelValue),()=>a("div",{class:g()},[a("div",{class:g("wrapper",{disabled:e.disabled})},[F(),u()])])}});const fo=ue(vo);const go={class:"body"},Fo={__name:"Profile",emits:["change"],setup(e,{emit:s}){const i=Ae(),o=d=>{console.log(d),Oe("文件大小不能超过 500kb")};re(()=>{s("change",te.currentRoute.value.meta.title)});const l=d=>{console.log(d,d.content),console.log(i.getName),Te(i.getName,{data:d.content}).then(h=>{console.log("uploadAvator",h),console.log("上传到服务器后，返回头像地址并修改userStore.avator"),h.code!=0?console.log("获取数据失败，"+h.message):(i.avator=h.data.avator,console.log("获取数据成功",i.avator))}).catch(h=>{console.log(h,"服务端错误！")})};function b(){i.logout().then(d=>{console.log("退出结果",d),d.code!=0?(ne({message:d.message,position:"top"}),console.log("用户退出失败")):(Ne({message:"用户退出成功",position:"top"}),te.push({name:"home"}))}).catch(d=>{ne({message:"服务端错误！",position:"top"}),console.log(d,"服务端错误！")})}return(d,h)=>{const y=ee,r=fo,c=Ke,P=ze,w=Ge;return Ce(),Ie("div",go,[a(P,{class:"space"},{default:L(()=>[a(c,{"is-link":"",title:"我的头像"},{value:L(()=>[a(r,{"after-read":l,"max-size":500*1024,onOversize:o},{default:L(()=>[a(y,{round:"",width:"35",height:"35",src:ae(i).avator},null,8,["src"])]),_:1})]),_:1}),a(c,{title:"真实姓名",value:ae(i).getName,to:{name:"changename"}},null,8,["value"]),a(c,{title:"身份证号",value:"4308***********",label:""}),a(c,{title:"推荐人",value:"彭清"})]),_:1}),a(P,{class:"space"},{default:L(()=>[a(c,{title:"账号安全","is-link":""}),a(c,{title:"隐私","is-link":""}),a(c,{title:"个人信息收集清单","is-link":""}),a(c,{title:"地址管理","is-link":""})]),_:1}),a(P,{class:"space"},{default:L(()=>[a(c,{title:"注销","is-link":""}),a(c,{title:"版本更新",value:"1.0.0.1"})]),_:1}),a(w,{class:"bottom-button",onClick:b},{default:L(()=>[ke("安全退出")]),_:1})])}}};export{Fo as default};
